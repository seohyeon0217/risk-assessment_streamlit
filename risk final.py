import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import time

st.set_page_config(layout="wide", page_title="AI ìŠ¤ë§ˆíŠ¸ ë°°í„°ë¦¬ JSA - ê³µì • íŠ¹í™”")
st.title("ğŸ’¡ AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ë°°í„°ë¦¬ JSA ìœ„í—˜ì„± í‰ê°€ (ê³µì • íŠ¹í™” + ì„ í–‰/í›„í–‰ í†µí•©) ğŸ’¡")
st.markdown("---")
st.write("ì•ˆë‡½ëƒ¥ë‡½ëƒ¥ì´! ğŸ‘‹ ì´ ì‹œìŠ¤í…œì€ **ë°°í„°ë¦¬ ì œì¡° 4ëŒ€ í•µì‹¬ ê³µì •ë³„ë¡œ íŠ¹í™”ëœ ìœ„í—˜ìš”ì¸**ì„ ë°”íƒ•ìœ¼ë¡œ **í˜„ì¬ì˜ ì•ˆì „ ê´€ë¦¬ ë…¸ë ¥(ì„ í–‰ì§€í‘œ)**ì„ í‰ê°€í•˜ê³ , **ê³¼ê±° ì‚¬ê³ /ê´€ë¦¬ ë¶€ì‹¤(í›„í–‰ì§€í‘œ)**ì„ ë¶„ì„í•˜ì—¬ ìœ„í—˜ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤. í›„í–‰ì§€í‘œë¥¼ í†µí•´ ë“œëŸ¬ë‚œ 'ì‚¬ê³ ì˜ êµí›ˆ'ì„ ì„ í–‰ì§€í‘œ ê°•í™”ì— ì ìš©í•˜ëŠ” **'í”¼ë“œë°± ë£¨í”„'**ë¥¼ êµ¬í˜„í•˜ì—¬, ê°€ì¥ í˜„ì‹¤ì ì´ê³  ì§€ëŠ¥ì ì¸ ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ê°€ëŠ¥ì„±ì„ ì œì‹œí•©ë‹ˆë‹¤. âœ¨")
st.markdown("---")

# --- ë°°í„°ë¦¬ ì œì¡° 4ëŒ€ í•µì‹¬ ê³µì • ì •ì˜ ë° ì •ë³´ ---
# ê° ê³µì •ë³„ ì£¼ìš” ìœ„í—˜ìš”ì¸ê³¼ ì´ì— ë”°ë¥¸ ë¹ˆë„/ê°•ë„ ë§¤í•‘ì„ ì •ì˜ (ê´€ë¦¬ ìˆ˜ì¤€ 1~5ì  -> ë¹ˆë„/ê°•ë„)
# (ê´€ë¦¬ ìˆ˜ì¤€ 1=ë¶ˆëŸ‰, 5=ìš°ìˆ˜)
# (ë¹ˆë„/ê°•ë„ 1=ë§¤ìš° ë‚®ìŒ, 5=ë§¤ìš° ë†’ìŒ)
battery_processes_details = {
    "ì „ê·¹ ê³µì •": {
        "desc": "ì–‘ê·¹/ìŒê·¹ í™œë¬¼ì§ˆì„ ë°”ì¸ë”ì™€ ì„ì–´ ìŠ¬ëŸ¬ë¦¬ë¥¼ ë§Œë“¤ê³ , ì½”íŒ…, ê±´ì¡°, í”„ë ˆìŠ¤, ìŠ¬ë¦¬íŒ…í•˜ëŠ” ê³µì •. (í™”í•™ë¬¼ì§ˆ ì·¨ê¸‰, ë¶„ì§„, í™”ì¬/í­ë°œ, ê¸°ê³„ì  ìœ„í—˜)",
        "risk_factors": {
            "í™”í•™ë¬¼ì§ˆ(ìŠ¬ëŸ¬ë¦¬, ìœ ê¸°ìš©ì œ) ëˆ„ì¶œ/í¡ì… ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í™”í•™ë¬¼ì§ˆ", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ë¶„ì§„ ë°œìƒ ë° ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í™˜ê²½/í˜¸í¡ê¸°", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:4,2:3,3:2,4:1,5:1}},
            "ê³ ì˜¨ ê±´ì¡° ì„¤ë¹„ ì´ìƒ ë° ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì„¤ë¹„/ì—´ìƒ", "freq_map": {1:4,2:3,3:2,4:1,5:1}, "sev_map": {1:4,2:3,3:2,4:1,5:1}},
            "í”„ë ˆìŠ¤/ìŠ¬ë¦¬í„° ë“± ê¸°ê³„ì  ë¼ì„/ì ˆë‹¨ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ê¸°ê³„", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ë°©í­ ë° í™˜ê¸° ì„¤ë¹„ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì„¤ë¹„/í™”ì¬", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
        }
    },
    "ì¡°ë¦½ ê³µì •": {
        "desc": "ì „ê·¹ì„ ê°ê±°ë‚˜ ìŒ“ì•„ ì ¤ë¦¬ë¡¤/ìŠ¤íƒì„ ë§Œë“¤ê³ , ì¼€ì´ìŠ¤ì— ë„£ê³  ì „í•´ì•¡ ì£¼ì… í›„ ë°€ë´‰í•˜ëŠ” ê³µì •. (í™”í•™ë¬¼ì§ˆ, ì§ˆì‹, ê¸°ê³„ì , ì—´ì  ìœ„í—˜)",
        "risk_factors": {
            "ì „í•´ì•¡ ì£¼ì… ì¤‘ ìœ ì¶œ/í¡ì… ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í™”í•™ë¬¼ì§ˆ", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ì „í•´ì•¡/ë°€ë´‰ ê´€ë ¨ í™”ì¬/í­ë°œ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í™”ì¬/í™”í•™", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ê¶Œì·¨/ìŠ¤íƒœí‚¹ ì¥ë¹„ ê¸°ê³„ì  ë¼ì„ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ê¸°ê³„", "freq_map": {1:4,2:3,3:2,4:1,5:1}, "sev_map": {1:4,2:3,3:2,4:1,5:1}},
            "ë¹„í™œì„± ê°€ìŠ¤(ì•„ë¥´ê³¤ ë“±) ì§ˆì‹ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í™”í•™ë¬¼ì§ˆ/í™˜ê²½", "freq_map": {1:4,2:3,3:2,4:1,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ìš©ì ‘/ë´‰í•© ìŠ¤íŒŒí¬ ë° ì—´ì  ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì—´", "freq_map": {1:3,2:2,3:1,4:1,5:1}, "sev_map": {1:3,2:2,3:1,4:1,5:1}},
        }
    },
    "í™œì„±í™” ê³µì •": {
        "desc": "ì¡°ë¦½ëœ ë°°í„°ë¦¬ì— ì´ˆê¸° ì¶©ë°©ì „ì„ í†µí•´ í™œë¬¼ì§ˆì„ í™œì„±í™”í•˜ê³  í’ˆì§ˆ ê²€ì‚¬. (ì—´í­ì£¼, ê°€ìŠ¤ ë°œìƒ, ì „ê¸°ì  ìœ„í—˜)",
        "risk_factors": {
            "ë¶ˆëŸ‰ ì…€ ì—´í­ì£¼/ë°œí™” ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì—´/í™”ì¬", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}}, # ì•„ë¦¬ì…€ ì‚¬ê³ ì™€ ì§ê²°
            "ì…€ ë‚´ë¶€ ê°€ìŠ¤ ë°œìƒ ë° í­ë°œ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í­ë°œ", "freq_map": {1:4,2:3,3:2,4:1,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ì´ˆê¸° ì „í•´ì•¡ ëˆ„ì¶œ ë° í¡ì… ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "í™”í•™ë¬¼ì§ˆ", "freq_map": {1:3,2:2,3:1,4:1,5:1}, "sev_map": {1:4,2:3,3:2,4:1,5:1}},
            "ì¶©ë°©ì „ ì„¤ë¹„ì˜ ì „ê¸°ì  ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì „ê¸°", "freq_map": {1:3,2:2,3:1,4:1,5:1}, "sev_map": {1:4,2:3,3:2,4:1,5:1}},
            "ê³¼ì—´ ëª¨ë‹ˆí„°ë§ ë° ìë™ ì§„í™” ì‹œìŠ¤í…œ ìœ ë¬´ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì•ˆì „ì‹œìŠ¤í…œ", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
        }
    },
    "íŒ© ê³µì •": {
        "desc": "ì—¬ëŸ¬ ê°œì˜ ì…€ì„ ëª¨ë“ˆ/íŒ©ìœ¼ë¡œ ì¡°ë¦½í•˜ê³  ë°°ì„ , ë³´í˜¸íšŒë¡œ ì—°ê²°, ìµœì¢… ê²€ì‚¬ ë° í¬ì¥. (ì „ê¸°ì , ë¬¼ë¦¬ì , ì—´ì  ìœ„í—˜)",
        "risk_factors": {
            "ê³ ì „ì•• ë°°ì„  ë° ì¡°ë¦½ ì¤‘ ê°ì „ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì „ê¸°", "freq_map": {1:5,2:4,3:3,4:2,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "ì…€/ëª¨ë“ˆ ìš´ë°˜/ì ì¬ ì¤‘ ë‚™í•˜/ì¶©ê²© ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ë¬¼ë¦¬", "freq_map": {1:4,2:3,3:2,4:1,5:1}, "sev_map": {1:4,2:3,3:2,4:1,5:1}},
            "ì¡°ë¦½/ìš©ì ‘ ìŠ¤íŒŒí¬ ë° í™”ì¬ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ì—´/í™”ì¬", "freq_map": {1:3,2:2,3:1,4:1,5:1}, "sev_map": {1:3,2:2,3:1,4:1,5:1}},
            "ë¶ˆëŸ‰ íŒ© ë°œí™”/í­ë°œ ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€ (ìµœì¢… ê²€ì‚¬)": {"type": "ì—´/í­ë°œ", "freq_map": {1:4,2:3,3:2,4:1,5:1}, "sev_map": {1:5,2:4,3:3,4:2,5:1}},
            "í¬ì¥/ìš´ë°˜ ìë™í™” ì„¤ë¹„ ê¸°ê³„ì  ìœ„í—˜ ê´€ë¦¬ ìˆ˜ì¤€": {"type": "ê¸°ê³„", "freq_map": {1:3,2:2,3:1,4:1,5:1}, "sev_map": {1:3,2:2,3:1,4:1,5:1}},
        }
    }
}
process_options = list(battery_processes_details.keys())
selected_process_step = st.selectbox("ğŸ”‹ ë°°í„°ë¦¬ ì œì¡° ê³µì • ë‹¨ê³„ ì„ íƒ", process_options)
st.markdown(f"*{battery_processes_details[selected_process_step]['desc']}*")

st.markdown("---")

# --- 1. ì„ í–‰ì§€í‘œ ì…ë ¥ (ê³µì •ë³„ ìœ„í—˜ìš”ì¸ ì„¸ë¶€ ì…ë ¥) ---
st.subheader("1ï¸âƒ£ ì„ í–‰ì§€í‘œ ì…ë ¥ (ê³µì •ë³„ ìœ„í—˜ìš”ì¸ ê´€ë¦¬ ìˆ˜ì¤€ í‰ê°€)")
st.markdown("ì„ íƒí•˜ì‹  ê³µì •ì˜ ì£¼ìš” ìœ„í—˜ìš”ì¸ë³„ í˜„ì¬ ì•ˆì „ ê´€ë¦¬ ìˆ˜ì¤€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)")

leading_factors_input = {}
current_process_risk_factors = battery_processes_details[selected_process_step]["risk_factors"]
lead_cols = st.columns(3) # ìœ„í—˜ìš”ì¸ì„ 3ì—´ë¡œ ë‚˜ëˆ„ì–´ í‘œì‹œ
for i, (factor_name, factor_details) in enumerate(current_process_risk_factors.items()):
    with lead_cols[i % 3]: # 0, 1, 2 ë°˜ë³µ
        leading_factors_input[factor_name] = st.slider(
            f"{factor_name} ({factor_details['type']})", 1, 5, 3, key=f"risk_{selected_process_step}_{i}"
        )
st.markdown("---")

# --- ì¶”ê°€ ì„ í–‰ì§€í‘œ ì…ë ¥ (ì „ì‚¬ì  ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ) ---
st.subheader("1-2ï¸âƒ£ ì¶”ê°€ ì„ í–‰ì§€í‘œ ì…ë ¥ (ì „ì‚¬ì  ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ ê±´ì „ì„± í‰ê°€)")
st.markdown("íšŒì‚¬ ì „ì²´ì˜ ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œê³¼ ê´€ë ¨ëœ ì ì¬ì  ìœ„í—˜ ìš”ì¸ê³¼ ì˜ˆë°© ë…¸ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.")

col1, col2 = st.columns(2)
with col1:
    st.write("### ğŸ‘· ì „ì‚¬ì  ì‘ì—… í™˜ê²½ ê´€ë¦¬")
    env_cleanliness = st.slider("ì „ì‚¬ì  ì‘ì—…ì¥ ì²­ê²°ë„ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_env_c_total")
    env_ventilation = st.slider("ì „ì‚¬ì  ì‘ì—…ì¥ í™˜ê¸° ìƒíƒœ (1:ë¶ˆëŸ‰ ~ 5:5)", 1, 5, 3, key="s_env_v_total")
    env_orderliness = st.slider("ì „ì‚¬ì  ì‘ì—…ì¥ ì •ë¦¬ì •ëˆ ìƒíƒœ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_env_o_total")
    env_chemical_exposure = st.slider("ì „ì‚¬ì  í™˜ê²½ í™”í•™ë¬¼ì§ˆ ë…¸ì¶œ ê´€ë¦¬ ìˆ˜ì¤€ (1:ë†’ìŒ ~ 5:ë‚®ìŒ)", 1, 5, 4, key="s_env_ce_total") # ê´€ë¦¬ ìˆ˜ì¤€ì´ë¯€ë¡œ 5ì ì´ ì¢‹ìŒ
    env_dust_level = st.slider("ì „ì‚¬ì  í™˜ê²½ ë¶„ì§„ ê´€ë¦¬ ìˆ˜ì¤€ (1:ë†’ìŒ ~ 5:ë‚®ìŒ)", 1, 5, 4, key="s_env_d_total")

    st.write("### ğŸ‘¨â€ğŸ­ ì „ì‚¬ì  ì‘ì—…ì ê´€ë¦¬")
    worker_skill = st.selectbox("ì „ì²´ ì‘ì—…ì í‰ê·  ìˆ™ë ¨ë„", ["ë¯¸ìˆ™ë ¨", "ë³´í†µ", "ìˆ™ë ¨"], key="s_w_s_total")
    worker_safety_compliance = st.slider("ì „ì²´ ì‘ì—…ì ì•ˆì „ìˆ˜ì¹™ ì¤€ìˆ˜ë„ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_w_sc_total")
    worker_ppe_compliance = st.slider("ì „ì²´ ì‘ì—…ì PPE ì°©ìš© ì¤€ìˆ˜ë„ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_w_ppe_total")
    worker_fatigue_mgmt = st.slider("ì‘ì—…ì í”¼ë¡œ ê´€ë¦¬ ì‹œìŠ¤í…œ (1:ë¯¸í¡ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_w_f_total")

with col2:
    st.write("### ğŸ› ï¸ ì „ì‚¬ì  ì„¤ë¹„ ê´€ë¦¬")
    equip_condition = st.slider("ì „ì²´ ì„¤ë¹„ í‰ê·  ê±´ì „ì„± (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_e_c_total")
    equip_inspection_cycle = st.slider("ì „ì‚¬ì  ì„¤ë¹„ ì ê²€ ì£¼ê¸° ì¤€ìˆ˜ìœ¨ (1:ë¯¸í¡ ~ 5:ìš°ìˆ˜)", 1, 5, 4, key="s_e_ic_total")
    equip_breakdown_history = st.select_slider("ì „ì‚¬ì  ì„¤ë¹„ ê³ ì¥ ì´ë ¥ (6ê°œì›”)", options=["ì—†ìŒ", "1~2íšŒ", "3íšŒ ì´ìƒ"], key="s_e_bh_total")
    equip_maintenance_quality = st.slider("ì „ì‚¬ì  ì„¤ë¹„ ìœ ì§€ë³´ìˆ˜ í’ˆì§ˆ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_e_mq_total")

    st.write("### ğŸ›¡ï¸ ì „ì‚¬ì  ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ (ì´ê´„)")
    safety_inspection_status = st.selectbox("ì „ì‚¬ì  ì•ˆì „ì ê²€ ì²´ê³„", ["ì •ê¸°ì ê²€ ì™„ë²½", "ìƒ˜í”Œì ê²€ ìœ„ì£¼", "ì ê²€ ë¯¸í¡/ë¯¸ì‹¤ì‹œ"], key="s_sm_is_total")
    fire_facility_adequacy = st.selectbox("ì „ì‚¬ì  ì†Œë°©ì‹œì„¤ ë²•ì  ê¸°ì¤€ ì¤€ìˆ˜", ["ê¸°ì¤€ ì´ˆê³¼ ì„¤ì¹˜", "ë²•ì  ê¸°ì¤€ ì¤€ìˆ˜", "ì„¤ì¹˜ ë¯¸í¡/ëŒ€ìƒ ì•„ë‹˜"], key="s_sm_ffa_total")
    special_extinguisher_presence = st.radio("ì „ì‚¬ì  íŠ¹ìˆ˜ ì†Œí™”ê¸°(ë°°í„°ë¦¬ ì „ìš©) ë³´ìœ  ì—¬ë¶€", ["ë³´ìœ ", "ë¯¸ë³´ìœ "], key="s_sm_sep_total")
    chemical_mgmt_msds = st.slider("ì „ì‚¬ì  í™”í•™ë¬¼ì§ˆ MSDS ê´€ë¦¬ ë° êµìœ¡ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_c_msds_total")
    chemical_mgmt_storage = st.slider("ì „ì‚¬ì  í™”í•™ë¬¼ì§ˆ ì €ì¥/ì·¨ê¸‰ ê´€ë¦¬ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_c_st_total")
    jsa_performance = st.slider("JSA(ì‘ì—…ì•ˆì „ë¶„ì„) ìˆ˜í–‰ ì™„ì„±ë„ (1:ë‚®ìŒ ~ 5:ë†’ìŒ)", 1, 5, 3, key="s_j_p_total")
    sops_compliance = st.slider("ì‘ì—…í‘œì¤€ì„œ(SOP) ì¤€ìˆ˜ë„ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_s_c_total")
    worker_safety_education_freq = st.slider("ì •ê¸° ì•ˆì „ êµìœ¡ ë¹ˆë„ (ì›”)", 0, 4, 1, key="s_w_sef_total")
    ptw_compliance = st.slider("ì‘ì—…í—ˆê°€ì œ(PTW) ì¤€ìˆ˜ë„ (1:ë¶ˆëŸ‰ ~ 5:ìš°ìˆ˜)", 1, 5, 3, key="s_p_c_total")

st.markdown("---")

# --- 2. í›„í–‰ì§€í‘œ ì…ë ¥ (ê³¼ê±° ì‚¬ê³  ë° ê´€ë¦¬ ë¶€ì‹¤ ì¤‘ì‹¬) ---
st.subheader("2ï¸âƒ£ í›„í–‰ì§€í‘œ ì…ë ¥ (ê³¼ê±° ì‚¬ê³  ê²°ê³¼ ë° ê´€ë¦¬ ì‹œìŠ¤í…œì˜ 'ì‹¤ì§ˆì  ë¶€ì‹¤' í‰ê°€)")
st.markdown("ê³¼ê±°ì— ì‹¤ì œë¡œ ë°œìƒí–ˆë˜ ì‚¬ê³ /ì‚¬ê±´, ë²•ê·œ ìœ„ë°˜, ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ëˆ„ì ëœ ë¶€ì‹¤ ë“±ì„ í†µí•´ **'ì‹œìŠ¤í…œì˜ ì§„ì •í•œ ì·¨ì•½ì„±'**ì„ í‰ê°€í•©ë‹ˆë‹¤.")
st.markdown("ğŸ’¡ **ë§Œì•½ 'ì•„ë¦¬ì…€ ê³µì¥'ì˜ ì‚¬ê³  ì „ ìƒíƒœë¥¼ ì‹œë®¬ë ˆì´ì…˜í•œë‹¤ë©´, ì•„ë˜ í•­ëª©ë“¤ì„ í•´ë‹¹ ì‚¬ê³ ê°€ ë°œìƒí• ë§Œí•œ ìƒíƒœë¡œ ì„¤ì •í•´ë³´ì„¸ìš”! (íŠ¹íˆ 'ì˜ˆ', 'ìˆìŒ', 'í™•ì¸ë¨', 'ë¶€ì ì ˆ/ë¶ˆë²• ë…¼ë€', 'ë¯¸í¡' ë“±ì„ ì„ íƒ)**")

col_lag1, col_lag2 = st.columns(2)

with col_lag1:
    st.write("### ğŸ’¥ ê³¼ê±° ì‚¬ê³  ê²°ê³¼ (ì¸ëª…/ì¬ì‚°/ìš´ì˜ ì†ì‹¤)")
    has_major_incident = st.radio("ê³¼ê±° ëŒ€í˜•/ì¤‘ëŒ€ ì¬í•´(ì‚¬ë§, ë‹¤ìˆ˜ ë¶€ìƒ ë“±)ê°€ ìˆì—ˆìŠµë‹ˆê¹Œ?", ["ì—†ìŒ", "ìˆìŒ"], key="l_pmao") 
    past_fatalities_count = 0
    past_injuries_count = 0
    if has_major_incident == "ìˆìŒ":
        past_fatalities_count = st.number_input("ê³¼ê±° ëŒ€í˜• ì¬í•´ë¡œ ì¸í•œ ì‚¬ë§ì ìˆ˜ (ëª…)", min_value=0, value=0, key="l_f_c")
        past_injuries_count = st.number_input("ê³¼ê±° ëŒ€í˜• ì¬í•´ë¡œ ì¸í•œ ë¶€ìƒì ìˆ˜ (ëª…)", min_value=0, value=0, key="l_i_c")

    st.write("### ğŸ’¸ ê³¼ê±° ë²•ê·œ ìœ„ë°˜ ë° í–‰ì • ì²˜ë¶„")
    past_fine_history_level = st.selectbox("ê³¼ê±° ì•ˆì „ ê´€ë ¨ ë²Œê¸ˆ ë¶€ê³¼ ì´ë ¥ (ì •ì„±ì  ìˆ˜ì¤€)", ["ì—†ìŒ", "ìˆìŒ (1íšŒì„±)", "ìƒìŠµì /ì¤‘ìš” ìœ„ë°˜ (2íšŒ ì´ìƒ)"], key="l_pf_h")
    past_hazard_over_storage = st.selectbox("ê³¼ê±° ìœ„í—˜ë¬¼ì§ˆ ê¸°ì¤€ ì´ˆê³¼ ë³´ê´€ ì ë°œ ì´ë ¥", ["ì—†ìŒ", "ìˆìŒ"], key="l_ph_os") # ì•„ë¦¬ì…€ ë¦¬íŠ¬ ì´ˆê³¼ ë³´ê´€ ë°˜ì˜

with col_lag2:
    st.write("### ğŸ“ ê³¼ê±° ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ í—ˆì ")
    past_hidden_accident_reports = st.selectbox("ê³¼ê±° ê²½ë¯¸ ì‚¬ê³  ë³´ê³  ëˆ„ë½/ì€í ì •í™©ì´ ìˆì—ˆìŠµë‹ˆê¹Œ?", ["ì—†ìŒ", "ì˜í˜¹ ìˆìŒ", "í™•ì¸ë¨"], key="l_ph_ar")
    past_safety_training_adequacy = st.selectbox("ê³¼ê±° ì•ˆì „ êµìœ¡ ë° ì¸ë ¥ ê´€ë¦¬ ì ì ˆì„± (íŠ¹íˆ íŒŒê²¬ì§)", ["ë§¤ìš° ì ì ˆ", "ë³´í†µ", "ë¶€ì ì ˆ/ë¶ˆë²• ë…¼ë€"], key="l_pst_a")
    past_safety_audit_compliance = st.selectbox("ê³¼ê±° ì•ˆì „ ê°ì‚¬ ì§€ì ì‚¬í•­ ê°œì„  ì‹¤ì ", ["ëª¨ë‘ ê°œì„  ì™„ë£Œ", "ì¼ë¶€ ê°œì„ ", "ê°œì„  ë¯¸í¡/í˜•ì‹ì "], key="l_psa_c")
    past_government_intervention = st.selectbox("ê³¼ê±° ì •ë¶€/ê¸°ê´€ìœ¼ë¡œë¶€í„°ì˜ ì‘ì—…ì¤‘ì§€ ë˜ëŠ” ê°•ë ¥ ê¶Œê³  ì´í–‰ ì—¬ë¶€", ["ëª¨ë‘ ì´í–‰", "ì¼ë¶€ ì´í–‰", "ì´í–‰ ë¯¸í¡"], key="l_pg_i")

st.markdown("---")

# --- JSA ìœ„í—˜ë„ í‰ê°€ í•¨ìˆ˜ (ë‚´ë¶€ ë¹ˆë„/ê°•ë„ ë§¤í•‘) ---
def evaluate_jsa_risk(factors_input, risk_factors_details):
    total_jsa_risk = 0
    detailed_risks = []
    
    for factor_name, factor_details in risk_factors_details.items():
        management_level = factors_input[factor_name] # 1~5ì 
        
        # ê´€ë¦¬ ìˆ˜ì¤€ì— ë”°ë¥¸ ë¹ˆë„(F)ì™€ ê°•ë„(S) ë§¤í•‘ (1=ìµœì•…, 5=ìµœê³ )
        freq = factor_details["freq_map"].get(management_level, 1)
        sev = factor_details["sev_map"].get(management_level, 1)
        
        risk_score = freq * sev
        total_jsa_risk += risk_score
        
        detailed_risks.append({
            "ìœ„í—˜ìš”ì¸": factor_name.split(' (')[0], # (ìœ í˜•) ë¶€ë¶„ ì œê±°
            "ìœ í˜•": factor_details['type'],
            "ê´€ë¦¬ìˆ˜ì¤€": management_level,
            "ë¹ˆë„(F)": freq,
            "ê°•ë„(S)": sev,
            "ìœ„í—˜ë„(F*S)": risk_score
        })
        
    return total_jsa_risk, pd.DataFrame(detailed_risks)

# --- ì„ í–‰ì§€í‘œ í‰ê°€ í•¨ìˆ˜ (Current Potential Risk) ---
def evaluate_leading_risk_score_total(jsa_total_risk):
    # ê³µì •ë³„ JSA ìœ„í—˜ë„ í•©ì‚° (leading_factors_inputì˜ ì´ ìœ„í—˜ë„)
    score = jsa_total_risk 
    
    # ì „ì‚¬ì  í™˜ê²½ ê´€ë¦¬
    score += (6 - env_cleanliness) * 2
    score += (6 - env_ventilation) * 2
    score += (6 - env_orderliness) * 2
    score += (6 - env_chemical_exposure) * 3 # 5ì ì´ ì¢‹ìœ¼ë¯€ë¡œ 6-ì ìœ¼ë¡œ
    score += (6 - env_dust_level) * 3

    # ì „ì‚¬ì  ì‘ì—…ì ê´€ë¦¬
    if worker_skill == "ë¯¸ìˆ™ë ¨": score += 5
    elif worker_skill == "ë³´í†µ": score += 2
    score += (6 - worker_safety_compliance) * 4
    score += (6 - worker_ppe_compliance) * 4
    score += (6 - worker_fatigue_mgmt) * 2 # í”¼ë¡œë„ 'ê´€ë¦¬ ìˆ˜ì¤€'ì´ë¯€ë¡œ 6-ì ìœ¼ë¡œ

    # ì „ì‚¬ì  ì„¤ë¹„ ê´€ë¦¬
    score += (6 - equip_condition) * 4
    score += (6 - equip_inspection_cycle) * 3
    if equip_breakdown_history == "3íšŒ ì´ìƒ": score += 5
    elif equip_breakdown_history == "1~2íšŒ": score += 2
    score += (6 - equip_maintenance_quality) * 3

    # ì „ì‚¬ì  ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ (ì´ê´„)
    if safety_inspection_status == "ì ê²€ ë¯¸í¡/ë¯¸ì‹¤ì‹œ": score += 5
    elif safety_inspection_status == "ìƒ˜í”Œì ê²€ ìœ„ì£¼": score += 3
    if fire_facility_adequacy == "ì„¤ì¹˜ ë¯¸í¡/ëŒ€ìƒ ì•„ë‹˜": score += 4
    elif fire_facility_adequacy == "ë²•ì  ê¸°ì¤€ ì¤€ìˆ˜": score += 1
    if special_extinguisher_presence == "ë¯¸ë³´ìœ ": score += 5
    score += (6 - chemical_mgmt_msds) * 3
    score += (6 - chemical_mgmt_storage) * 4
    score += (6 - jsa_performance) * 3
    score += (6 - sops_compliance) * 2
    score += (6 - (worker_safety_education_freq * 1.5)) * 2 # íšŸìˆ˜ê°€ ë‚®ìœ¼ë©´ ìœ„í—˜
    score += (6 - ptw_compliance) * 3

    return round(score, 2)

# --- í›„í–‰ì§€í‘œ 'ìœ„í—˜ ìƒíƒœ' íŒë³„ ë° ë‚´ë¶€ ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜ ---
def get_lagging_status_and_score(fatalities, injuries, has_major_incident_bool, fine_history_level, over_storage, hidden_reports, training_adequacy, audit_compliance, govt_intervention):
    score = 0
    # 1. ì¸ëª… í”¼í•´ (ê°€ì¥ ê°•ë ¥í•œ ìš”ì†Œ)
    if has_major_incident_bool == "ìˆìŒ":
        if fatalities >= 10: # ì•„ë¦¬ì…€ (23ëª… ì‚¬ë§)ê¸‰ ëŒ€í˜• ì‚¬ê³ 
            score += 250 # ìµœìƒìœ„ ì ìˆ˜ (ì¹˜ëª…ì )
        elif fatalities > 0:
            score += 150 # ì‚¬ë§ì ë°œìƒ ì‹œ ë§¤ìš° ë†’ì€ ì ìˆ˜
        elif injuries >= 5:
            score += 100 # ë‹¤ìˆ˜ ë¶€ìƒì ë°œìƒ ì‹œ ë†’ì€ ì ìˆ˜
        elif injuries > 0:
            score += 50 # ë¶€ìƒì ë°œìƒ ì‹œ ì ìˆ˜
    
    # 2. ë²•ê·œ ìœ„ë°˜ ë° í–‰ì • ì²˜ë¶„
    if fine_history_level == "ìˆìŒ (1íšŒì„±)": score += 30
    elif fine_history_level == "ìƒìŠµì /ì¤‘ìš” ìœ„ë°˜ (2íšŒ ì´ìƒ)": score += 60 
    if over_storage == "ìˆìŒ": score += 70 # ìœ„í—˜ë¬¼ì§ˆ ì´ˆê³¼ ë³´ê´€

    # 3. ê³¼ê±° ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ í—ˆì 
    if hidden_reports == "ì˜í˜¹ ìˆìŒ": score += 40
    elif hidden_reports == "í™•ì¸ë¨": score += 80 # í™•ì •ëœ ì€í ì‹œ ë” ì‹¬ê°
    
    if training_adequacy == "ë¶€ì ì ˆ/ë¶ˆë²• ë…¼ë€": score += 70
    
    if audit_compliance == "50% ë¯¸ë§Œ (ê°œì„  ë¯¸í¡)": score += 60
    elif audit_compliance == "50%~99%": score += 30 # 'ì¼ë¶€ ê°œì„ 'ì— í•´ë‹¹í•˜ëŠ” êµ¬ê°„
    
    if govt_intervention == "ì´í–‰ ë¯¸í¡": score += 50

    # ìµœì¢… ìƒíƒœ íŒë³„
    if score >= 250: # ëŒ€ê·œëª¨ ì¸ëª…í”¼í•´ ë˜ëŠ” ë³µí•©ì ì´ê³  ì¹˜ëª…ì ì¸ ë¶€ì‹¤
        status = "ì‹¬ê°í•œ ê²°í•¨ ì´ë ¥ (Critical Failure History)"
    elif score >= 150: # ì¸ëª…í”¼í•´ ë˜ëŠ” ë‹¤ìˆ˜ ì‹¬ê° ë¶€ì‹¤
        status = "ì£¼ìš” ì‹œìŠ¤í…œ ë¶€ì‹¤ (Major System Failure)"
    elif score >= 80: # ì¤‘ë“±ë„ ë¶€ì‹¤ (ë²Œê¸ˆ, ì€í ì˜í˜¹ ë“±)
        status = "ê²½ê³  í•„ìš” (Warning Required)"
    else: # ë¬¸ì œì  ì ê±°ë‚˜ ì—†ìŒ
        status = "ì£¼ëª©í•  ë¬¸ì œ ì—†ìŒ (No Significant Issues)" # ì´ì œ 'í´ë¦° ë ˆì½”ë“œ'ëŠ” ë” ì—„ê²©í•œ ê¸°ì¤€ì—ì„œ ì‚¬ìš©

    return status, score

# --- ê³µì •ë³„ ì´ ìœ„í—˜ë„ â†’ ë“±ê¸‰ ë³€í™˜ í•¨ìˆ˜ ---
def get_risk_level(total_risk_score):
    if total_risk_score <= 25: return "ë§¤ìš° ë‚®ìŒ" # Very Low (5ê°œ ìš”ì¸ * 5ì  ë¯¸ë§Œ)
    elif total_risk_score <= 50: return "ë‚®ìŒ"    # Low
    elif total_risk_score <= 75: return "ë³´í†µ"    # Medium
    elif total_risk_score <= 100: return "ë†’ìŒ"   # High
    else: return "ë§¤ìš° ë†’ìŒ" # Very High (100ì  ì´ˆê³¼)

# --- í‰ê°€ ìˆ˜í–‰ ---
with st.spinner('ìœ„í—˜ì„± í‰ê°€ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ğŸ§'):
    time.sleep(1.5)
    
    jsa_total_risk_score, jsa_details_df = evaluate_jsa_risk(leading_factors_input, current_process_risk_factors)
    leading_score_raw = evaluate_leading_risk_score_total(jsa_total_risk_score) # ì„ í–‰ì§€í‘œ ì´ ì ìˆ˜
    
    lagging_status, lagging_score_raw = get_lagging_status_and_score(
        past_fatalities_count, past_injuries_count, accident_occurred, # 'accident_occurred' radio button value used here
        past_fine_history_level, past_hazard_over_storage, past_hidden_accident_reports,
        past_safety_training_adequacy, past_safety_audit_compliance, past_government_intervention
    )

    leading_grade = get_risk_level(leading_score_raw) # ì„ í–‰ì§€í‘œ ë“±ê¸‰
    
# --- 6. ê²°ê³¼ ì¶œë ¥ ---
st.subheader("âœ… ìœ„í—˜ì„± í‰ê°€ ê²°ê³¼")
st.markdown("---")

col_res1, col_res2 = st.columns(2)
with col_res1:
    st.success("### ğŸš€ ì„ í–‰ì§€í‘œ ìœ„í—˜ë„ ë“±ê¸‰ (í˜„ì¬ ê´€ë¦¬ ìƒíƒœì˜ ìœ„í—˜ ìˆ˜ì¤€)")
    st.write(f"**{selected_process_step} ê³µì •ì˜ ì´ ìœ„í—˜ë„:** **{leading_grade}** (ì´ì : {leading_score_raw}ì )")
    st.markdown("""
    - **ì˜ë¯¸**: í˜„ì¬ ì‹œì ì˜ ì•ˆì „ ê´€ë¦¬ ë…¸ë ¥ê³¼ ì‹œìŠ¤í…œì˜ ê±´ì „ì„±ì„ ë°˜ì˜í•œ ìœ„í—˜ë„. ì ì¬ì ì¸ ì‚¬ê³  ê°€ëŠ¥ì„±ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
    - **í™œìš©**: ì˜ˆë°© í™œë™ ê³„íš ìˆ˜ë¦½ ë° í˜„ì¬ ê´€ë¦¬ ì‹œìŠ¤í…œ ê°œì„  ë°©í–¥ ì„¤ì •ì— í™œìš©ë©ë‹ˆë‹¤.
    """)
    st.write("#### ê³µì •ë³„ ìœ„í—˜ìš”ì¸ ìƒì„¸")
    st.table(jsa_details_df) # JSA ìœ„í—˜ìš”ì¸ ìƒì„¸ í‘œë¡œ ì¶œë ¥

with col_res2:
    st.warning("### ğŸ•°ï¸ í›„í–‰ì§€í‘œ ìœ„í—˜ ìƒíƒœ (ê³¼ê±° ì‚¬ê³  ì´ë ¥ ë° ê´€ë¦¬ ë¶€ì‹¤ ìˆ˜ì¤€)")
    st.write(f"**ì‹œìŠ¤í…œì˜ ê³¼ê±° ìœ„í—˜ ìƒíƒœ:** **{lagging_status}** (ë‚´ë¶€ ì ìˆ˜: {lagging_score_raw}ì )")
    st.markdown("""
    - **ì˜ë¯¸**: ê³¼ê±°ì˜ ì‹¤ì œ ì‚¬ê³  ê²°ê³¼, ë²•ê·œ ìœ„ë°˜, ê´€ë¦¬ ì‹œìŠ¤í…œì˜ êµ¬ì¡°ì  ë¶€ì‹¤ì„ ë°˜ì˜í•œ ìœ„í—˜ë„. 'ìˆ¨ê²¨ì§„ ìœ„í—˜'ì„ ë“œëŸ¬ëƒ…ë‹ˆë‹¤.
    - **í™œìš©**: ê·¼ë³¸ì ì¸ ë¬¸ì œì  íŒŒì•… ë° ì‹œìŠ¤í…œì  ê°œì„ , ê³¼ê±°ì˜ êµí›ˆ í•™ìŠµì— í™œìš©ë©ë‹ˆë‹¤.
    """)
st.markdown("---")

# --- 7. ì„ í–‰ vs. í›„í–‰ ì§€í‘œ ë¹„êµ ë¶„ì„ ---
st.subheader("ğŸ” ì„ í–‰ vs. í›„í–‰ ì§€í‘œ ë¹„êµ ë¶„ì„: ì•„ë¦¬ì…€ ì‚¬ê³ ì˜ ì‹¬ì¸µ êµí›ˆ")
st.markdown("ì„ í–‰ì§€í‘œì™€ í›„í–‰ì§€í‘œëŠ” **ë³¸ì§ˆì ìœ¼ë¡œ ë‹¤ë¥¸ ì§€í‘œ**ì´ì§€ë§Œ, ì„œë¡œë¥¼ ë³´ì™„í•˜ë©° **ì§„ì •í•œ ìœ„í—˜ì„ ë“œëŸ¬ë‚´ê³  ë¯¸ë˜ì˜ ì•ˆì „ì„ ì„¤ê³„í•˜ëŠ” ë° í•„ìˆ˜ì **ì…ë‹ˆë‹¤. í›„í–‰ì§€í‘œ(ê³¼ê±° ë°ì´í„° ë° ê´€ë¦¬ ë¶€ì‹¤)ë¥¼ í†µí•´ ë“œëŸ¬ë‚œ ìœ„í—˜ì´ ì„ í–‰ì§€í‘œ(í˜„ì¬ì˜ ê´€ë¦¬ ë…¸ë ¥)ë¥¼ ì–´ë–»ê²Œ ë³´ì™„í•´ì•¼ í•˜ëŠ”ì§€ ë¹„êµí•©ë‹ˆë‹¤.")

col_comp_chart, col_comp_text = st.columns([0.6, 0.4])

with col_comp_chart:
    fig, ax = plt.subplots(figsize=(7, 4))
    # ë“±ê¸‰ë³„/ìƒíƒœë³„ ìƒ‰ìƒ ì¡°ì •
    bar_colors_leading = {'ë§¤ìš° ë‚®ìŒ': 'lightgreen', 'ë‚®ìŒ': 'skyblue', 'ë³´í†µ': 'lightyellow', 'ë†’ìŒ': 'salmon', 'ë§¤ìš° ë†’ìŒ': 'red'}
    bar_colors_lagging = {'ì£¼ëª©í•  ë¬¸ì œ ì—†ìŒ': 'forestgreen', 'ê²½ê³  í•„ìš” (Warning Required)': 'orange', 'ì£¼ìš” ì‹œìŠ¤í…œ ë¶€ì‹¤ (Major System Failure)': 'darkorange', 'ì‹¬ê°í•œ ê²°í•¨ ì´ë ¥ (Critical Failure History)': 'darkred', 'ì£¼ìš” ì¸ëª… í”¼í•´': 'darkred', 'í´ë¦° ë ˆì½”ë“œ': 'darkgreen'} # 'í´ë¦° ë ˆì½”ë“œ' ì¶”ê°€

    bars = ax.bar(["ì„ í–‰ì§€í‘œ", "í›„í–‰ì§€í‘œ"], [leading_score_raw, lagging_score_raw], 
                   color=[bar_colors_leading.get(leading_grade, 'gray'), bar_colors_lagging.get(lagging_status, 'gray')])
    
    ax.set_ylim(0, max(leading_score_raw, lagging_score_raw) + 40) # yì¶• ì—¬ìœ  ê³µê°„ í™•ë³´
    ax.set_ylabel("ìœ„í—˜ë„ ì ìˆ˜ (ë‚´ë¶€ ê³„ì‚°)")
    ax.set_title(f"'{selected_process_step}' ê³µì • ìœ„í—˜ë„ ë¹„êµ")

    # ê·¸ë˜í”„ ìœ„ì— ë“±ê¸‰/ìƒíƒœ í…ìŠ¤íŠ¸ í‘œì‹œ
    for bar, text_display in zip(bars, [leading_grade, lagging_status]):
        yval = bar.get_height()
        ax.text(bar.get_x() + bar.get_width()/2, yval + 1, f"{text_display}\n({yval:.0f}ì )", ha='center', va='bottom', fontsize=10, weight='bold')
    
    # ì•„ë¦¬ì…€ ì‚¬ê³  ë¶€ì‹¤ ì‚¬ë¡€ë¥¼ ê·¸ë˜í”„ ì˜†ì— ì£¼ì„ìœ¼ë¡œ í‘œì‹œ (í›„í–‰ì§€í‘œ ìƒíƒœê°€ ì‹¬ê°í•  ê²½ìš°)
    if lagging_status in ["ì£¼ìš” ì¸ëª… í”¼í•´", "ì£¼ìš” ì‹œìŠ¤í…œ ë¶€ì‹¤ (Major System Failure)", "ì‹¬ê°í•œ ê²°í•¨ ì´ë ¥ (Critical Failure History)"]:
        ax.text(1.05, 0.95, "âš ï¸ **ì•„ë¦¬ì…€ ì‚¬ê³ ì™€ ê°™ì€ ê³¼ê±° ë¬¸ì œì **", transform=ax.transAxes, fontsize=10, verticalalignment='top', bbox=dict(boxstyle='round,pad=0.5', fc='lightcoral', ec='firebrick', lw=1, alpha=0.5))
        ax.text(1.05, 0.88, "- ì‚¬ê³  ì „ í™”ì¬ ì€í ì˜í˜¹", transform=ax.transAxes, fontsize=8, verticalalignment='top')
        ax.text(1.05, 0.81, "- ì•ˆì „ì ê²€ ì²´ê³„ì˜ í—ˆì ", transform=ax.transAxes, fontsize=8, verticalalignment='top')
        ax.text(1.05, 0.74, "- íŠ¹ìˆ˜ ì†Œí™”ê¸° ë¶€ì¬", transform=ax.transAxes, fontsize=8, verticalalignment='top')
        ax.text(1.05, 0.67, "- ìœ„í—˜ë¬¼ì§ˆ ì´ˆê³¼ ë³´ê´€", transform=ax.transAxes, fontsize=8, verticalalignment='top')
        ax.text(1.05, 0.60, "- ì•ˆì „êµìœ¡/ì¸ë ¥ê´€ë¦¬ ë¶€ì‹¤", transform=ax.transAxes, fontsize=8, verticalalignment='top')
        ax.text(1.05, 0.53, "â¡ **í›„í–‰ì§€í‘œê°€ ì´ë¥¼ ê°•ë ¥íˆ ê²½ê³ !**", transform=ax.transAxes, fontsize=9, verticalalignment='top', color='red')
        fig.tight_layout() # ê·¸ë˜í”„ì™€ ì£¼ì„ ê²¹ì¹˜ì§€ ì•Šê²Œ ë ˆì´ì•„ì›ƒ ì¡°ì •
    
    st.pyplot(fig)


with col_comp_text:
    # ì„ í–‰ vs í›„í–‰ ë“±ê¸‰ ë¹„êµ í•´ì„
    if lagging_status == "ì‹¬ê°í•œ ê²°í•¨ ì´ë ¥ (Critical Failure History)":
        st.error(f"**â— ê²½ê³ : í›„í–‰ì§€í‘œ ìƒíƒœ '{lagging_status}'ëŠ” ì„ í–‰ì§€í‘œ '{leading_grade}' ë“±ê¸‰ì˜ í˜„ì¬ ë…¸ë ¥ì„ ë¬´ìƒ‰í•˜ê²Œ í•©ë‹ˆë‹¤.**")
        st.markdown(f"""
        ### ì•„ë¦¬ì…€ ì‚¬ê³ ì˜ ì´ì²´ì  ë¶€ì‹¤, ë‹¨ê³„ë³„ ì‹¬ì¸µ ë¶„ì„
        **ê³¼ê±°ì˜ ì¹˜ëª…ì ì¸ ë¬¸ì œë“¤ì´ ì‹¤ì œ ì‚¬ê³ ë¡œ ì´ì–´ì¡Œê±°ë‚˜, ì‚¬ê³ ë¥¼ ì¼ìœ¼í‚¬ ë§Œí•œ ì‹œìŠ¤í…œì  ë¶€ì‹¤ì´ ëˆ„ì ë˜ì–´ ìˆì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì„ í–‰ì§€í‘œë¡œ ê°€ë ¤ì¡Œë˜ í—ˆì ì´ í›„í–‰ì§€í‘œë¥¼ í†µí•´ ë“œëŸ¬ë‚¬ìŠµë‹ˆë‹¤.**
        """)
        # ì¸í„°ë™í‹°ë¸Œ UI ìš”ì†Œ (Expander ì‚¬ìš©)
        with st.expander("ë‹¨ê³„ 1: ê²‰ìœ¼ë¡œë§Œ ë³´ì´ëŠ” ì•ˆì „ê³¼ ìˆ¨ê²¨ì§„ ìœ„í—˜"):
            st.markdown("""
            **ë¬¸ì œì **: ì•„ë¦¬ì…€ ì‚¬ê³  ì´ì „, ê³µì¥ì€ 'ìš°ìˆ˜ì‚¬ì—…ì¥'ìœ¼ë¡œ ì„ ì •ë˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” **ì„ í–‰ì§€í‘œ(í˜•ì‹ì  ì ê²€, ì„œë¥˜ìƒ ê¸°ì¤€)ë§Œìœ¼ë¡œëŠ” ì‹¤ì œ ìœ„í—˜ì„ í¬ì°©í•˜ê¸° ì–´ë ¤ì›€**ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. **í˜„ì¬ì˜ ì²­ê²°ë„, ì„¤ë¹„ ì ê²€ ì£¼ê¸°ê°€ ì–‘í˜¸í•´ ë³´ì—¬ë„, ì‹œìŠ¤í…œì /ë¬¸í™”ì  ë¶€ì‹¤ì€ ê°€ë ¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
            """)
        with st.expander("ë‹¨ê³„ 2: ê³¼ê±° ê´€ë¦¬ ë¶€ì‹¤ì˜ ì¹˜ëª…ì ì¸ ëˆ„ì "):
            st.markdown("""
            **ì›ì¸**: ì‚¬ê³  ì „ **ì‚¬ê³  ì „ í™”ì¬ ì€í ì˜í˜¹, ìœ„í—˜ë¬¼ì§ˆ ì´ˆê³¼ ë³´ê´€ ë²Œê¸ˆ ì´ë ¥, 'ìƒ˜í”Œ ì ê²€'ì— ê·¸ì¹œ ì•ˆì „ì ê²€, ê·¸ë¦¬ê³  ê°ì‚¬ ì§€ì  ê°œì„  ë¯¸í¡** ë“± ê³¼ê±°ì˜ 'ìˆ¨ê²¨ì§„ ë¶€ì‹¤'ì´ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” í›„í–‰ì§€í‘œê°€ 'ì‹¬ê°í•œ ê²°í•¨ ì´ë ¥'ì„ ë³´ì¸ í•µì‹¬ì ì¸ ì´ìœ ì…ë‹ˆë‹¤. **ëª…ëª©ìƒì˜ ì•ˆì „ ê´€ë¦¬ê°€ ì•„ë‹Œ, ì‹¤ì œ ìœ„í—˜ì„ í†µì œí•˜ì§€ ëª»í–ˆë˜ ê²°ê³¼ê°€ ì´ ìƒíƒœë¡œ ì§ê²°ë©ë‹ˆë‹¤.**
            """)
        with st.expander("ë‹¨ê³„ 3: ê³ ìœ„í—˜ ê³µì •ì˜ íŠ¹ì„±ê³¼ ë¶€ì‹¤ì˜ í­ë°œì ì¸ ì‹œë„ˆì§€"):
            st.markdown(f"""
            **ìƒí™©**: íŠ¹íˆ '{selected_process_step}'ê³¼ ê°™ì€ ê³ ì—ë„ˆì§€ ë°°í„°ë¦¬ ê³µì •ì—ì„œëŠ” ë¶ˆëŸ‰ ì œí’ˆ ì²˜ë¦¬ ê³¼ì •ì˜ ì‚¬ì†Œí•œ ë¬¸ì œ(ê³¼ë„í•œ ë°œì—´, ì—´í­ì£¼)ê°€ **ëŒ€í˜• í­ë°œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ì¹˜ëª…ì  ìœ„í—˜**ì„ ë‚´í¬í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³ ìœ„í—˜ ìƒí™©ì—ì„œ **íŠ¹ìˆ˜ ì†Œí™”ê¸° ë¶€ì¬, ë¶€ì‹¤í•œ ë¹„ìƒ ëŒ€ì‘ í›ˆë ¨** ë“±ì´ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ í—ˆì ì„ ë”ìš± ë¶€ê°ì‹œì¼œ í›„í–‰ì§€í‘œ ë“±ê¸‰ì„ í­ë°œì ìœ¼ë¡œ ìƒìŠ¹ì‹œí‚¤ëŠ” ìš”ì¸ì´ ë©ë‹ˆë‹¤.
            """)
        with st.expander("ë‹¨ê³„ 4: ì¸ì  ìš”ì†Œ ë° ë²•ê·œ ì‚¬ê°ì§€ëŒ€ì˜ ìœ„í—˜ ì¦í­"):
            st.markdown("""
            **ê²°ê³¼**: ë¶ˆë²• íŒŒê²¬ ë…¼ë€ ì† **íŒŒê²¬ì§ì— ëŒ€í•œ ì•ˆì „ êµìœ¡ ë¶€ì‹¤**ì€ ë¯¸ìˆ™ë ¨ ì‘ì—…ìì˜ ì•ˆì „ í–‰ë™ ìœ„í—˜ì„ ê°€ì¤‘ì‹œì¼°ìŠµë‹ˆë‹¤. ë˜í•œ **ì†Œë°©ë²•ìƒ ë¦¬íŠ¬ í™”ì¬ì˜ íŠ¹ìˆ˜ì„± ë¯¸ë°˜ì˜, íŠ¹ìˆ˜ ì†Œí™”ê¸° ê·œì • ë¯¸ë¹„** ë“± ë²•ê·œì™€ í˜„ì‹¤ì˜ ê´´ë¦¬ê°€ ì‚¬ê³ ë¥¼ í‚¤ìš´ ì›ì¸ì´ ë©ë‹ˆë‹¤. **ê³¼ê±° ë¶ˆë²• íŒŒê²¬ ì ë°œ, êµìœ¡ ì´ìˆ˜ìœ¨ ì €ì¡°ì™€ ê°™ì€ í›„í–‰ì§€í‘œëŠ” ì´ëŸ¬í•œ ì¸ì /ì‹œìŠ¤í…œì  ì·¨ì•½ì ì„ ëª…ë°±íˆ ë³´ì—¬ì¤ë‹ˆë‹¤.**
            """)
        st.markdown(f"""
        **ì´í‰**: í›„í–‰ì§€í‘œ ìƒíƒœê°€ ì‹¬ê°í•˜ë‹¤ëŠ” ê²ƒì€ ì´ì²˜ëŸ¼ **ë‹¨ìˆœíˆ ê³¼ê±° ì‚¬ê³  ë¹ˆë„ê°€ ë†’ì•„ì„œê°€ ì•„ë‹ˆë¼, ê·¸ ì´ë©´ì— ê¹”ë¦° ì´ì²´ì  ê´€ë¦¬ ë¶€ì‹¤ê³¼ ì‹œìŠ¤í…œì  ê²°í•¨ì´ ì¶•ì ëœ ê²°ê³¼**ì…ë‹ˆë‹¤. ì´ëŠ” í˜•ì‹ì ì¸ ì„ í–‰ì§€í‘œ ê´€ë¦¬ë§Œìœ¼ë¡œëŠ” ëŒ€í˜• ì‚¬ê³ ë¥¼ ë§‰ì„ ìˆ˜ ì—†ìœ¼ë©°, **ê³¼ê±°ì˜ ì‹¤ì§ˆì  ë¬¸ì œë¥¼ ì§ì‹œí•˜ê³  ê°œì„ í•´ì•¼ë§Œ ì§„ì •í•œ ì•ˆì „ì´ í™•ë³´ë¨ì„ ê°•ë ¥íˆ ê²½ê³ **í•©ë‹ˆë‹¤.
        """)
        st.markdown("---")
    
    elif lagging_status == "ì£¼ìš” ì‹œìŠ¤í…œ ë¶€ì‹¤ (Major System Failure)":
        st.error(f"**â— ê²½ê³ : í›„í–‰ì§€í‘œ ìƒíƒœ '{lagging_status}'ëŠ” ì„ í–‰ì§€í‘œ '{leading_grade}'ì—ë„ ë¶ˆêµ¬í•˜ê³  ì‹œìŠ¤í…œì˜ ì£¼ìš” ê²°í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.**")
        st.markdown("""
        ê³¼ê±° ì¸ëª… í”¼í•´ê°€ ë°œìƒí–ˆê±°ë‚˜, ë‹¤ìˆ˜ì˜ ë²•ê·œ ìœ„ë°˜ ë° ê´€ë¦¬ í—ˆì ë“¤ì´ ëˆ„ì ë˜ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì„ í–‰ì§€í‘œê°€ í˜„ì¬ì˜ ë…¸ë ¥ì„ ë³´ì—¬ì£¼ë”ë¼ë„, ì´ëŸ¬í•œ ê³¼ê±°ì˜ 'í° ë¬¸ì œë“¤'ì€ í˜„ì¬ ì‹œìŠ¤í…œì— ê·¼ë³¸ì ì¸ ì·¨ì•½ì ì´ ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤. ì¦‰ê°ì ì´ê³  ì „ë°˜ì ì¸ ê°œì„  ë…¸ë ¥ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.
        """)
        st.markdown("---")

    elif lagging_status == "ê²½ê³  í•„ìš” (Warning Required)":
        st.warning(f"**âš  í›„í–‰ì§€í‘œ ìƒíƒœ '{lagging_status}': í˜„ì¬ëŠ” ì•ˆì „í•´ ë³´ì—¬ë„ ê³¼ê±°ì˜ ê²½ê³  ì‹ í˜¸ì— ì£¼ëª©í•´ì•¼ í•©ë‹ˆë‹¤.**")
        st.markdown("""
        ê³¼ê±° ì•ˆì „ ê´€ë ¨ ë²Œê¸ˆ, ë³´ê³  ëˆ„ë½ ì˜í˜¹, ê°ì‚¬ ì§€ì  ê°œì„  ë¯¸í¡ ë“± **ê²½ê³  ì‹ í˜¸ë“¤ì´ ì¡´ì¬í–ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.** í˜„ì¬ ì„ í–‰ì§€í‘œ ë“±ê¸‰ì´ ì–‘í˜¸í•˜ë”ë¼ë„, ì´ëŸ¬í•œ ê³¼ê±°ì˜ ì‘ì€ ë¬¸ì œë“¤ì´ ëˆ„ì ë˜ë©´ ì–¸ì œë“  ëŒ€í˜• ì‚¬ê³ ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰ê°ì ì¸ ì›ì¸ ë¶„ì„ê³¼ ê°œì„  ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.
        """)
        st.markdown("---")

    else: # í´ë¦° ë ˆì½”ë“œ ë˜ëŠ” ì£¼ëª©í•  ë¬¸ì œ ì—†ìŒ
        st.info(f"**âœ… í›„í–‰ì§€í‘œ ìƒíƒœ '{lagging_status}': í˜„ì¬ ê´€ë¦¬ ë…¸ë ¥ì´ ê³¼ê±° ë°ì´í„°ì™€ ì¼ì¹˜í•©ë‹ˆë‹¤.**")
        st.markdown("""
        ê³¼ê±°ì— í° ì‚¬ê³ ë‚˜ ì‹¬ê°í•œ ê´€ë¦¬ ë¶€ì‹¤ ì´ë ¥ì´ ì—†ìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ëŠ” í˜„ì¬ì˜ ì„ í–‰ì§€í‘œ ê¸°ë°˜ ì˜ˆë°© ë…¸ë ¥ì´ ì˜ ì‘ë™í•˜ê³  ìˆë‹¤ëŠ” ê¸ì •ì ì¸ ì‹ í˜¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ, 'í´ë¦° ë ˆì½”ë“œ'ê°€ ì˜ì›í•œ ì•ˆì „ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì§€ì†ì ì¸ ìœ„í—˜ì„± í‰ê°€ì™€ ê°œì„  ë…¸ë ¥ì„ í†µí•´ í˜„ì¬ì˜ ë†’ì€ ì•ˆì „ ìˆ˜ì¤€ì„ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.
        """)
        st.markdown("---")

# --- 8. ìœ„í—˜ì„± ê°ì†Œ ëŒ€ì±… ë° ì‹¤í–‰ í›„ ìœ„í—˜ë„ ì‹œë®¬ë ˆì´ì…˜ ---
st.subheader("8. ìœ„í—˜ì„± ê°ì†Œ ëŒ€ì±… ë° ì‹¤í–‰ í›„ ìœ„í—˜ë„ ì‹œë®¬ë ˆì´ì…˜")
st.markdown("ì„ íƒëœ ê³µì •ì—ì„œ ì‹ë³„ëœ ìœ„í—˜ìš”ì¸ì— ëŒ€í•´ ê°ì†Œ ëŒ€ì±…ì„ ìˆ˜ë¦½í•˜ê³ , ì‹¤í–‰ í›„ ìœ„í—˜ë„ ê°ì†Œ íš¨ê³¼ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.")

# JSA ìœ„í—˜ìš”ì¸ë³„ ê°ì†Œ ëŒ€ì±… ì…ë ¥
st.write(f"#### {selected_process_step} ê³µì • ìœ„í—˜ì„± ê°ì†Œ ëŒ€ì±…")
reduced_risk_amounts = {}
for factor_name in current_process_risk_factors.keys():
    reduced_risk_amounts[factor_name] = st.number_input(f"'{factor_name}' ìœ„í—˜ë„ ê°ì†Œ ì˜ˆìƒëŸ‰ (0~{jsa_details_df[jsa_details_df['ìœ„í—˜ìš”ì¸'] == factor_name.split(' (')[0]]['ìœ„í—˜ë„(F*S)'].iloc[0]})", 
                                                         min_value=0, 
                                                         max_value=int(jsa_details_df[jsa_details_df['ìœ„í—˜ìš”ì¸'] == factor_name.split(' (')[0]]['ìœ„í—˜ë„(F*S)'].iloc[0]),
                                                         value=0,
                                                         key=f"reduce_{selected_process_step}_{factor_name}")

if st.button("ê°ì†Œ ëŒ€ì±… ì ìš© ë° ìœ„í—˜ë„ ì¬í‰ê°€ ì‹œë®¬ë ˆì´ì…˜"):
    st.markdown("---")
    st.subheader("ğŸ“‰ ê°ì†Œ ëŒ€ì±… ì ìš© í›„ ì˜ˆìƒ ìœ„í—˜ë„")
    
    simulated_jsa_details = jsa_details_df.copy()
    simulated_jsa_details['ê°ì†Œ ì˜ˆìƒëŸ‰'] = simulated_jsa_details['ìœ„í—˜ìš”ì¸'].apply(lambda x: reduced_risk_amounts[f"{x} ê´€ë¦¬ ìˆ˜ì¤€"] if f"{x} ê´€ë¦¬ ìˆ˜ì¤€" in reduced_risk_amounts else 0)
    simulated_jsa_details['ê°ì†Œ í›„ ìœ„í—˜ë„(F*S)'] = simulated_jsa_details['ìœ„í—˜ë„(F*S)'] - simulated_jsa_details['ê°ì†Œ ì˜ˆìƒëŸ‰']
    simulated_jsa_details['ê°ì†Œ í›„ ìœ„í—˜ë„(F*S)'] = simulated_jsa_details['ê°ì†Œ í›„ ìœ„í—˜ë„(F*S)'].apply(lambda x: max(0, x)) # 0 ë¯¸ë§Œ ë°©ì§€
    
    simulated_total_jsa_risk = simulated_jsa_details['ê°ì†Œ í›„ ìœ„í—˜ë„(F*S)'].sum()
    simulated_leading_score_raw = evaluate_leading_risk_score_total(simulated_total_jsa_risk)
    simulated_leading_grade = get_risk_level(simulated_leading_score_raw)

    st.write(f"#### {selected_process_step} ê³µì • (ê°ì†Œ ëŒ€ì±… ì ìš© í›„)")
    st.table(simulated_jsa_details)
    st.write(f"ê°ì†Œ ëŒ€ì±… ì ìš© í›„ ì˜ˆìƒ ì´ ìœ„í—˜ë„: **{simulated_total_jsa_risk:.2f}ì **")
    st.write(f"ê°ì†Œ ëŒ€ì±… ì ìš© í›„ ì˜ˆìƒ ì„ í–‰ì§€í‘œ ë“±ê¸‰: **{simulated_leading_grade}** (ì´ì : {simulated_leading_score_raw}ì )")

    fig_sim, ax_sim = plt.subplots()
    ax_sim.bar(["í˜„ì¬ ìœ„í—˜ë„", "ê°ì†Œ í›„ ì˜ˆìƒ ìœ„í—˜ë„"], [leading_score_raw, simulated_leading_score_raw], color=["salmon", "lightgreen"])
    ax_sim.set_ylim(0, max(leading_score_raw, simulated_leading_score_raw) + 20)
    ax_sim.set_ylabel("ì´ ìœ„í—˜ë„ ì ìˆ˜")
    ax_sim.set_title(f"'{selected_process_step}' ê³µì • ì„ í–‰ì§€í‘œ ë³€í™” ì‹œë®¬ë ˆì´ì…˜")
    for bar in ax_sim.patches:
        yval = bar.get_height()
        ax_sim.text(bar.get_x() + bar.get_width()/2, yval + 1, f"{yval:.2f}", ha='center', va='bottom')
    st.pyplot(fig_sim)


# --- 9. í›„í–‰ì§€í‘œ ê¸°ë°˜ ì„ í–‰ì§€í‘œ ë³´ì™„ ë£¨í‹´ ---
st.subheader("ğŸ” í›„í–‰ì§€í‘œ ê¸°ë°˜ ì„ í–‰ì§€í‘œ ë³´ì™„ ë£¨í‹´: ì‚¬ê³ ì˜ êµí›ˆì„ ë¯¸ë˜ ì•ˆì „ìœ¼ë¡œ")
st.markdown("ì•„ë¦¬ì…€ ì‚¬ê³ ì™€ ê°™ì€ ì¤‘ëŒ€ ì¬í•´ì˜ **'ê³¼ê±° ë°ì´í„°(í›„í–‰ì§€í‘œ)'ë¥¼ ë¶„ì„**í•˜ì—¬, **ë¯¸ë˜ì˜ ì‚¬ê³ ë¥¼ ë§‰ì„ ìˆ˜ ìˆëŠ” 'ì„ í–‰ì§€í‘œ'ë¥¼ ì–´ë–»ê²Œ ê°•í™”**í•  ìˆ˜ ìˆëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ë£¨í‹´ì…ë‹ˆë‹¤.")

# Streamlit Session State ì´ˆê¸°í™”
if 'show_rca' not in st.session_state:
    st.session_state.show_rca = False
if 'rca_applied' not in st.session_state:
    st.session_state.rca_applied = False

# ì‚¬ê³  ë°œìƒ ë²„íŠ¼
if st.button("ğŸš¨ ì‚¬ê³  ë°œìƒ! (í›„í–‰ì§€í‘œ ì¸ì§€ & ë³´ì™„ ë£¨í‹´ ì‹œì‘)"):
    st.session_state.show_rca = True
    st.session_state.rca_applied = False # ìƒˆë¡œìš´ ì‚¬ê³  ë°œìƒ ì‹œ ë£¨í‹´ ì´ˆê¸°í™”

if st.session_state.show_rca:
    st.markdown("---")
    st.success("### âœ… ì‚¬ê³  ë°ì´í„° ìˆ˜ì§‘ ë° ì›ì¸ ë¶„ì„ (RCA)")
    st.markdown("""
    **ì‚¬ê³  ì‹œë‚˜ë¦¬ì˜¤**: 2024ë…„ 6ì›”, í™”ì„± ì•„ë¦¬ì…€ ê³µì¥ 'í”„ë ˆìŠ¤ ë° ìŠ¬ë¦¬íŒ…' ê³µì •ì—ì„œ ë¶ˆëŸ‰ ë¦¬íŠ¬ì´ì˜¨ ë°°í„°ë¦¬ ì²˜ë¦¬ ì¤‘ í­ë°œ, ëŒ€ê·œëª¨ ì¸ëª… í”¼í•´ ë°œìƒ (ì‚¬ë§ 23ëª…). 
    """)
    st.markdown("""
    **RCA (Root Cause Analysis) ê²°ê³¼**:
    - **ì§ì ‘ ì›ì¸**: ë¶ˆëŸ‰ ë°°í„°ë¦¬ ì—´í­ì£¼, ì´ˆê¸° í™”ì¬ ì§„ì•• ì‹¤íŒ¨ (ì¼ë°˜ ì†Œí™”ê¸° ì‚¬ìš©, íŠ¹ìˆ˜ ì†Œí™”ê¸° ë¶€ì¬)
    - **ê°„ì ‘ ì›ì¸**: ê³¼ë°€ ì ì¬, í†µí’ ë¶ˆëŸ‰, ì •ì „ê¸° ë“± ë°œí™” ì¡°ê±´, ë¶ˆëŸ‰í’ˆ ê´€ë¦¬ ë¯¸í¡, **ì‚¬ê³  ì „ ê²½ë¯¸ í™”ì¬ ì€í, ì•ˆì „ì ê²€ ë¶€ì‹¤, ìœ„í—˜ë¬¼ì§ˆ ì´ˆê³¼ ë³´ê´€**
    - **ê·¼ë³¸ ì›ì¸**: **ì•ˆì „ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ì²´ì  ë¶€ì‹¤** (ëª…ëª©ìƒ 'ìš°ìˆ˜ì‚¬ì—…ì¥'ì´ì—ˆìœ¼ë‚˜ ì‹¤ì œë¡œëŠ” JSA, SOP, PTW ë“± í˜•ì‹ì  ê´€ë¦¬, êµìœ¡ ë¯¸í¡, ì¸ë ¥ê´€ë¦¬ ë¬¸ì œ, ë¹„ìƒ ëŒ€ì‘ í›ˆë ¨ ë¯¸í¡)
    """)
    st.markdown("---")
    st.warning("### ğŸ› ï¸ ë¯¸í¡í–ˆë˜ ì„ í–‰ì§€í‘œ ë„ì¶œ ë° ê°•í™”ëœ ì„ í–‰ì§€í‘œ ì œì•ˆ")
    st.markdown("""
    ìœ„ RCA ê²°ê³¼ì— ë”°ë¼, ì‚¬ê³  ì´ì „ì— 'ì‘ë™í–ˆì–´ì•¼ í• ' ì„ í–‰ì§€í‘œë“¤ì´ ë¬´ì—‡ì´ì—ˆê³ , ì•ìœ¼ë¡œ ì–´ë–»ê²Œ ê°•í™”ë˜ì–´ì•¼ í• ì§€ ë„ì¶œí•©ë‹ˆë‹¤.
    """)

    st.markdown("#### ğŸ” ë¯¸í¡í–ˆë˜ ê³¼ê±° ì„ í–‰ì§€í‘œ (ì•„ë¦¬ì…€ ì‚¬ë¡€):")
    st.markdown("- **[ê´€ë¦¬ ë¶€ì‹¤]** **ì•ˆì „ì ê²€ ì²´ê³„**: 'ìƒ˜í”Œ ì ê²€'ìœ¼ë¡œ ì‹¤ì œ ìœ„í—˜ ê°„ê³¼.")
    st.markdown("- **[ì•ˆì „ ì„¤ë¹„ ë¶€ì¬]** **ì†Œë°©ì‹œì„¤**: ìŠ¤í”„ë§í´ëŸ¬ ì„¤ì¹˜ ì˜ë¬´ ëŒ€ìƒ ì•„ë‹˜, **íŠ¹ìˆ˜ ì†Œí™”ê¸° ë¶€ì¬**.")
    st.markdown("- **[ìœ„í—˜ë¬¼ ê´€ë¦¬]** **í™”í•™ë¬¼ì§ˆ ì €ì¥ ê´€ë¦¬**: ë¦¬íŠ¬ ë“± ìœ„í—˜ë¬¼ì§ˆ ê·œì • ì´ˆê³¼ ë³´ê´€ (ë²Œê¸ˆ ì´ë ¥).")
    st.markdown("- **[í–‰ë™ ì•ˆì „/êµìœ¡]** **ì‘ì—…ì ì•ˆì „ êµìœ¡**: íŒŒê²¬ì§ ë“± ì•ˆì „ êµìœ¡ ë° ê´€ë¦¬ ë¶€ì‹¤ (ë¶ˆë²• íŒŒê²¬ ë…¼ë€).")
    st.markdown("- **[ì ˆì°¨/ëª¨ë‹ˆí„°ë§]** **JSA, SOP, PTW**: ìˆ˜í–‰ ì™„ì„±ë„ ë‚®ê±°ë‚˜ í˜•ì‹ì , ì˜¨ë„/ìŠµë„ ëª¨ë‹ˆí„°ë§ ë¶€ì¬.")
    st.markdown("- **[ë¹„ìƒ ëŒ€ì‘]** **ëŒ€í”¼ ê²½ë¡œ/í›ˆë ¨**: í”¼ë‚œìœ ë„ë“± ë¯¸í¡, ë¹„ìƒ í›ˆë ¨ ë¶€ì‹¤ (ì‘ì—…ì ì „ì› ì‚¬ë§).")

    st.markdown("#### âœ… ê°•í™”ëœ ì„ í–‰ì§€í‘œ ì œì•ˆ (ì„ íƒí•˜ì—¬ ë°˜ì˜):")
    
    enhance_options = {
        "JSA(ì‘ì—…ì•ˆì „ë¶„ì„) ìˆ˜í–‰ ì™„ì„±ë„ ë†’ì„": False,
        "ì‘ì—…í‘œì¤€ì„œ(SOP) ì¤€ìˆ˜ë„ ê°•í™”": False,
        "ì‘ì—…í—ˆê°€ì œ(PTW) ì—„ê²© ì ìš©": False,
        "ë°°í„°ë¦¬ ë³´ê´€ ì˜¨ë„/ìŠµë„ ìë™ ì„¼ì„œ ë° ê²½ê³  ì‹œìŠ¤í…œ ë„ì…": False,
        "ì •ì „ê¸° ë°œìƒ ê°€ëŠ¥ì„± í‰ê°€ ë° ë°©ì§€ ëŒ€ì±… ê°•í™”": False,
        "ë°©í­ í™˜ê¸° ì‹œìŠ¤í…œ ì ê²€ ë° ë³´ê°•": False,
        "ë¦¬íŠ¬ íŠ¹ì„± ë° ë¹„ìƒ ëŒ€ì‘ í›ˆë ¨ ê°•í™” (ì›” 1íšŒ ì´ìƒ)": False,
        "í”¼ë‚œ ìœ ë„ë“± ë° ë¹„ìƒ ëŒ€í”¼ ê²½ë¡œ í™•ë³´/í›ˆë ¨ ê°•í™”": False,
        "ì „ì‚¬ì  ì •ê¸° ì•ˆì „ì ê²€ ì˜ë¬´í™” ë° ì‹¤ì§ˆ ì ê²€ ê°•í™”": False,
        "ë°°í„°ë¦¬ ì „ìš© íŠ¹ìˆ˜ ì†Œí™”ê¸° ë¹„ì¹˜ ë° ì†Œë°© ì‹œì„¤ ë³´ê°•": False,
        "ìœ„í—˜ë¬¼ì§ˆ ì €ì¥/ì·¨ê¸‰ ê·œì • ì¤€ìˆ˜ ë° ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§": False,
        "íŒŒê²¬ì§ í¬í•¨ ì „ ì§ì›ì— ëŒ€í•œ ì² ì €í•œ ì•ˆì „ êµìœ¡ ì‹¤ì‹œ": False
    }

    for option, _ in enhance_options.items():
        enhance_options[option] = st.checkbox(option, value=False, key=f"enhance_{option.replace(' ', '_')}")

    if st.button("âœ” ì„ íƒëœ ì„ í–‰ì§€í‘œ ê°•í™” ì œì•ˆ ë°˜ì˜ (ì‹œë®¬ë ˆì´ì…˜)"):
        st.session_state.rca_applied = True # ë°˜ì˜ íŠ¸ë¦¬ê±°
        st.success("**JSA í‰ê°€ì„œ ê°±ì‹  ë° ì„ í–‰ì§€í‘œ ê°•í™” ë°©ì•ˆì´ ì„±ê³µì ìœ¼ë¡œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤!**")
        st.markdown("""
        - **JSA ìë™ ì—…ë°ì´íŠ¸**: ê´€ë ¨ ì‘ì—… JSA í•­ëª©ì— ì„ íƒëœ ê°•í™”ëœ ì„ í–‰ì§€í‘œê°€ ì¶”ê°€/ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
        - **ê´€ë¦¬ì ì•Œë¦¼**: ì•ˆì „ ê´€ë¦¬ìì—ê²Œ ë³€ê²½ëœ JSA ë° ê°•í™” ë°©ì•ˆì´ ìë™ í†µë³´ë©ë‹ˆë‹¤.
        - **ì‘ì—…ì êµìœ¡**: ë³€ê²½ëœ ë‚´ìš©ì— ëŒ€í•œ ì‘ì—…ì êµìœ¡ ì¼ì •ì´ ìë™ ë“±ë¡ë˜ê³ , êµìœ¡ ì´ìˆ˜ í›„ ì ìš©ë©ë‹ˆë‹¤.
        - **ì£¼ê¸°ì  ëª¨ë‹ˆí„°ë§**: ê°•í™”ëœ ì„ í–‰ì§€í‘œì˜ ì‹¤ì œ ì ìš© ë° íš¨ê³¼ì— ëŒ€í•œ ëª¨ë‹ˆí„°ë§ì´ ì‹œì‘ë©ë‹ˆë‹¤.
        """)
    
    if st.session_state.rca_applied:
        st.info("ğŸ’¡ ì´ì œ ì„ í–‰ì§€í‘œ ì…ë ¥ ë¶€ë¶„ìœ¼ë¡œ ëŒì•„ê°€, **ì„ íƒëœ ê°•í™” ë°©ì•ˆì— ë§ì¶° ì…ë ¥ ê°’ì„ ë³€ê²½í•˜ì—¬ ì¬í‰ê°€**í•˜ë©´, ìœ„í—˜ë„ê°€ ì–´ë–»ê²Œ ë‚®ì•„ì§€ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

st.markdown("---")
st.info("â­ **ì¤‘ìš”**: ë³¸ ì‹œìŠ¤í…œì€ í•œêµ­ì‚°ì—…ì•ˆì „ë³´ê±´ê³µë‹¨ ë° ê³ ìš©ë…¸ë™ë¶€ ìë£Œ, ê·¸ë¦¬ê³  ì•„ë¦¬ì…€ ì‚¬ê³ ì™€ ê°™ì€ ì‹¤ì œ ì‚¬ë¡€ë¥¼ ì°¸ê³ í•˜ì—¬ ê°œë°œëœ AI ê¸°ë°˜ì˜ ì˜ˆì¸¡/ì¶”ì²œ ìë£Œì…ë‹ˆë‹¤. ì‹¤ì œ í˜„ì¥ ìƒí™©ê³¼ ìœ„í—˜ë„ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë°˜ë“œì‹œ **ì „ë¬¸ê°€ì˜ ì •ë°€ ì§„ë‹¨ ë° í˜„ì¥ íŠ¹ì„±ì„ ê³ ë ¤í•œ ìœ„í—˜ì„± í‰ê°€**ë¥¼ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ëª¨ë“  ê¸°ì—…ê³¼ ê·¼ë¡œìëŠ” **ì‚°ì—…ì•ˆì „ë³´ê±´ë²• ë° ì¤‘ëŒ€ì¬í•´ì²˜ë²Œë²•ì„ ì¤€ìˆ˜**í•˜ì—¬ ì•ˆì „í•œ ì‘ì—… í™˜ê²½ì„ ì¡°ì„±í•  ì˜ë¬´ê°€ ìˆìŠµë‹ˆë‹¤. ì•ˆì „ì€ ì–¸ì œë‚˜ ìµœìš°ì„ ì…ë‹ˆë‹¤! â­")